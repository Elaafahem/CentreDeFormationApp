<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head(title='Gestion des Étudiants')}"></head>

<body>

  <div class="wrapper">
    <!-- Sidebar -->
    <nav th:replace="~{fragments/layout :: sidebar}"></nav>

    <!-- Page Content -->
    <div id="content">
      <!-- Top Navbar -->
      <div th:replace="~{fragments/layout :: top-navbar}"></div>

      <div class="main-container">

        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2 class="fw-bold text-dark mb-1">Gestion des Étudiants</h2>
            <p class="text-muted mb-0">Visualisez et gérez l'ensemble des étudiants du centre.</p>
          </div>
          <div class="d-flex gap-2">
            <a th:href="@{/etudiant/form}" class="btn btn-primary shadow-sm">
              <i class="fas fa-plus me-2"></i>Nouvel Étudiant
            </a>
            <button class="btn btn-outline-secondary shadow-sm">
              <i class="fas fa-download me-2"></i>Exporter
            </button>
          </div>
        </div>

        <!-- Filters Block (Aesthetic only) -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body p-3">
            <form class="row g-3 align-items-center">
              <div class="col-md-4">
                <div class="input-group border rounded">
                  <span class="input-group-text bg-white border-0"><i class="fas fa-search text-muted"></i></span>
                  <input type="text" class="form-control border-0 ps-0" placeholder="Rechercher par nom ou email...">
                </div>
              </div>
              <div class="col-md-3">
                <select class="form-select border-0 bg-light">
                  <option value="">Tous les groupes</option>
                </select>
              </div>
              <div class="col-md-3">
                <select class="form-select border-0 bg-light">
                  <option value="">Toutes les dates</option>
                </select>
              </div>
              <div class="col-md-2">
                <button type="button" class="btn btn-primary w-100 shadow-sm">Filtrer</button>
              </div>
            </form>
          </div>
        </div>

        <div class="card border-0 shadow-sm overflow-hidden">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="bg-light text-muted">
                  <tr>
                    <th class="ps-4 py-3">Étudiant</th>
                    <th class="py-3">Groupe</th>
                    <th class="py-3">Contact</th>
                    <th class="py-3">Date d'inscription</th>
                    <th class="text-end pe-4 py-3">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="e : ${etudiants}" class="transition-all">
                    <td class="ps-4">
                      <div class="d-flex align-items-center">
                        <div class="me-3">
                          <div th:unless="${e.nom == null}"
                            class="rounded-circle d-flex align-items-center justify-content-center fw-bold shadow-sm"
                            style="width: 48px; height: 48px; background-color: #dbeafe; color: #2563eb; font-size: 1.2rem;">
                            <span th:text="${#strings.substring(e.nom,0,1)}">N</span>
                          </div>
                          <div th:if="${e.nom == null}"
                            class="rounded-circle d-flex align-items-center justify-content-center bg-light text-muted"
                            style="width: 48px; height: 48px;">
                            <i class="fas fa-user"></i>
                          </div>
                        </div>
                        <div>
                          <h6 class="mb-0 fw-bold text-dark" th:text="${e.prenom} + ' ' + ${e.nom}">
                            Nom Prénom</h6>
                          <small class="text-muted d-block">Matricule: <span
                              th:text="${e.matricule != null ? e.matricule : 'N/A'}">M001</span></small>
                        </div>
                      </div>
                    </td>
                    <td>
                      <span th:if="${e.groupe != null}" class="badge bg-primary-soft text-primary px-3 rounded-pill"
                        th:text="${e.groupe.nom}">TP1</span>
                      <span th:unless="${e.groupe != null}"
                        class="badge bg-light text-muted px-3 rounded-pill small">Non assigné</span>
                    </td>
                    <td>
                      <div class="d-flex flex-column">
                        <span class="text-dark small fw-medium"><i class="far fa-envelope me-1 text-primary"
                            style="opacity: 0.7;"></i> <span th:text="${e.email}">email@example.com</span></span>
                      </div>
                    </td>
                    <td>
                      <span class="text-secondary small fw-medium">
                        <i class="far fa-calendar-alt me-1 text-primary" style="opacity: 0.7;"></i>
                        <span th:text="${#dates.format(e.dateInscription, 'dd MMM yyyy')}">01 Jan 2024</span>
                      </span>
                    </td>
                    <td class="text-end pe-4">
                      <div class="d-flex justify-content-end gap-2">
                        <a th:href="@{/etudiant/edit(id=${e.id})}"
                          class="btn btn-sm btn-outline-primary border-0 rounded-circle"
                          style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center;"
                          title="Modifier">
                          <i class="fas fa-edit small"></i>
                        </a>
                        <a th:href="@{/etudiant/delete(id=${e.id})}"
                          class="btn btn-sm btn-outline-danger border-0 rounded-circle"
                          style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center;"
                          onclick="return confirm('Êtes-vous sûr de vouloir supprimer cet étudiant ?')"
                          title="Supprimer">
                          <i class="fas fa-trash-alt small"></i>
                        </a>
                      </div>
                    </td>
                  </tr>
                  <!-- Empty State -->
                  <tr th:if="${#lists.isEmpty(etudiants)}">
                    <td colspan="5" class="text-center py-5">
                      <div class="py-4">
                        <i class="fas fa-users-slash fa-4x text-light mb-4"></i>
                        <h5 class="text-muted fw-bold">Aucun étudiant trouvé</h5>
                        <p class="text-muted mx-auto" style="max-width: 300px;">Il semble qu'aucun étudiant ne soit
                          encore inscrit ou aucun ne correspond à votre recherche.</p>
                        <a th:href="@{/etudiant/form}" class="btn btn-primary mt-2 shadow-sm">
                          <i class="fas fa-plus me-2"></i>Inscrire le premier étudiant
                        </a>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div th:replace="~{fragments/layout :: scripts}"></div>

  <style>
    .bg-primary-soft {
      background-color: rgba(37, 99, 235, 0.1);
    }

    .transition-all {
      transition: all 0.2s ease-in-out;
    }

    .table tbody tr:hover {
      background-color: rgba(37, 99, 235, 0.02);
    }

    .extra-small {
      font-size: 0.75rem;
    }
  </style>


</body>

</html>